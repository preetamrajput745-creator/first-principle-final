groups:
- name: Audit_Security_Alerts
  rules:

  # 1. Unauthorized Config Change
  # (Simulated via finding 'unauthorized' tag or similar logic in metric)
  - alert: UnauthorizedConfigChange
    expr: audit_change_unauthorized > 0
    labels:
      severity: critical
      channel: pager
    annotations:
      summary: "Unauthorized Config Change Detected"
      
  # 2. After-Hours Change
  # Time-of-day check (UTC hours <9 or >17)
  - alert: AfterHoursChange
    expr: (hour() < 9 or hour() > 17) and rate(audit_changes_total[5m]) > 0
    labels:
      severity: high
      channel: slack
    annotations:
      summary: "After-Hours Change Detected"

  # 3. Burst Change
  - alert: ChangeBurst
    expr: rate(audit_changes_total[10m]) * 600 > 50
    labels:
      severity: warning
      channel: slack
    annotations:
      summary: "High Rate of Changes (Burst)"

  # 5. Signed Hash Failure
  - alert: AuditIntegrityFailure
    expr: audit_hash_verification_failures > 0
    labels:
      severity: critical
      channel: pager
    annotations:
      summary: "Audit Log Tampering Detected (Hash Mismatch)"
